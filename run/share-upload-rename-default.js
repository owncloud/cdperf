"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./_chunks/index-07d82955.js"),t=require("k6/crypto"),r=require("k6/execution");function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}require("k6"),require("k6/http"),require("https://jslib.k6.io/url/1.0.0/index.js"),require("k6/encoding"),require("https://jslib.k6.io/k6-utils/1.2.0/index.js");var i=a(r),n={baseURL:__ENV.BASE_URL||"https://localhost:9200",authAdapter:__ENV.AUTH_ADAPTER==e.Adapter.basicAuth?e.Adapter.basicAuth:e.Adapter.openIDConnect,apiVersion:__ENV.API_VERSION==e.Version.legacy?e.Version.legacy:e.Version.latest,testFolder:"share-upload-rename-default",adminUser:{login:__ENV.ADMIN_LOGIN||"admin",password:__ENV.ADMIN_PASSWORD||"admin"},assets:{size:parseInt(__ENV.ASSET_SIZE)||1024,quantity:parseInt(__ENV.ASSET_QUANTITY)||10},k6:{vus:5,iterations:50,insecureSkipTLSVerify:!0}},s=new e.API(n.baseURL,n.apiVersion),o=n.k6;exports.default=function(r){var a=r.userInfos[i.default.vu.idInTest-1],o=s.user.get(a,n.authAdapter).user,d=[i.default.scenario.iterationInTest,"initial",o.login].join("-");s.dav.create(a.home,d,o.credential);var u=t.randomBytes(1024*n.assets.size);e.times_1(n.assets.quantity,(function(e){s.dav.upload(a.home,[d,e].join("/"),u,o.credential)}));var l=[i.default.scenario.iterationInTest,"final",o.login].join("-");s.dav.move(a.home,d,l,o.credential)},exports.options=o,exports.setup=function(){var t=s.user.get({login:n.adminUser.login,password:n.adminUser.password},n.authAdapter).user,r=e._objectSpread2(e._objectSpread2({},t),{},{home:String(s.me.driveInfo(t.login,t.credential,{selector:'value.#(driveType=="personal").id'}))});return s.dav.create(r.home,n.testFolder,t.credential),{adminInfo:r,userInfos:e.times_1(o.vus||1,(function(){var r=s.user.create({login:e.randomString(),password:e.randomString()},t.credential,n.authAdapter).user,a=s.share.create(n.testFolder,t.credential,r.login);return s.share.accept(a.id,r.credential),e._objectSpread2(e._objectSpread2({},r),{},{home:String(s.me.driveInfo([r.login,n.testFolder].join("/"),r.credential,{selector:'value.#(driveAlias=="mountpoint/'.concat(n.testFolder,'").id')}))})}))}},exports.teardown=function(e){var t=e.adminInfo,r=e.userInfos,a=s.user.get(t,n.authAdapter).user;s.dav.delete(t.home,n.testFolder,a.credential),r.forEach((function(e){return s.user.delete(e.login,a.credential)}))};
