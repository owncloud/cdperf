"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../_chunks/dav-d6854223.js"),t=require("k6");require("k6/encoding"),require("k6/http");var a=require("../_chunks/users-6dd6ac35.js");require("k6/metrics"),require("k6/crypto");var r={size:1024,unit:"KB"},o=new e.Factory(e.buildAccount({login:e.ACCOUNTS.ADMIN})),n={davCreate:new e.Create,davUpload:new e.Upload,davMove:new e.Move,davDelete:new e.Delete,davPropfind:new e.Propfind},s=parseInt(__ENV.TARGET_BASE_VUS)||100,c=parseInt(__ENV.TARGET_MAX_VUS)||1e3;var i={tags:{test_id:"model-user-ramping-up-stress-test"},setupTimeout:(2*c).toString().concat("s"),teardownTimeout:(2*c+60).toString().concat("s"),scenarios:{warmup:{executor:"ramping-vus",startVUs:0,stages:[{duration:60..toString().concat("s"),target:s}],gracefulRampDown:"0s",tags:{metric_tag:"warmup"}},run:{executor:"constant-vus",vus:s,startTime:60..toString().concat("s"),duration:60..toString().concat("s"),tags:{metric_tag:"run"}},rampup:{executor:"ramping-vus",startVUs:0,startTime:120..toString().concat("s"),stages:[{duration:120..toString().concat("s"),target:c}],gracefulRampDown:"0s",tags:{metric_tag:"rampup"}},stress:{executor:"constant-vus",vus:c,startTime:240..toString().concat("s"),duration:180..toString().concat("s"),tags:{metric_tag:"stress"}},recover:{executor:"ramping-vus",startTime:420..toString().concat("s"),startVUs:c,stages:[{duration:60..toString().concat("s"),target:s}],gracefulRampDown:"30s",tags:{metric_tag:"recover"}},normalize:{executor:"constant-vus",vus:s,startTime:480..toString().concat("s"),duration:60..toString().concat("s"),tags:{metric_tag:"normalize"}}}};exports.default=function(){var t="k6-user".concat((__VU%c).toString()),a={name:t,credential:new e.Factory({login:t,password:"change-me-please"}).credential},o=n.davCreate.exec({credential:a.credential,path:"foobar",userName:a.name,tags:{precondition_failed:(!1).toString()}}),s=e.buildAsset(e._objectSpread2(e._objectSpread2({},r),{},{name:"dummy.zip",generatedName:!1})),i=n.davUpload.exec({asset:s,credential:a.credential,userName:a.name,path:"",tags:{precondition_failed:(!1).toString()}});n.davMove.exec({credential:a.credential,userName:a.name,path:"dummy.zip",destination:"foobar/dummy-new.zip",tags:{precondition_failed:(!o.ok||!i.ok).toString()}}),n.davDelete.exec({credential:a.credential,userName:a.name,path:"foobar",tags:{precondition_failed:(!o.ok).toString()}}),n.davPropfind.exec({credential:a.credential,userName:a.name,path:"",tags:{precondition_failed:(!1).toString()}})},exports.options=i,exports.setup=function(){console.log("Generating ".concat(c.toString()).concat(" users"));for(var e=0;e<c;e++){var r=a.Create.exec({userName:"k6-user".concat(e.toString()),password:"change-me-please",email:"k6-user".concat(e.toString()).concat("@example.com"),credential:o.credential});200!=r.status&&console.log(r.status.toString().concat(" ").concat(r.error)),e%50==0&&t.sleep(1)}console.log("done")},exports.teardown=function(){t.sleep(60),console.log("Deleting ".concat(c.toString()).concat(" users"));for(var e=0;e<c;e++){var r=a.Delete.exec({userName:"k6-user".concat(e.toString()),credential:o.credential});200!=r.status&&console.log(r.status.toString().concat(" ").concat(r.error).concat(" for ").concat("k6-user").concat(e.toString())),e%50==0&&t.sleep(1)}console.log("done")};
